# Metiokulto ç®¡ç†åå°

åŸºäº Refine æ¡†æ¶æ„å»ºçš„ Metiokulto æ•°æ®ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºç®¡ç† Supabase æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“¦ **äº§å“ç®¡ç†** - ç®¡ç†ç½‘ç«™äº§å“ä¿¡æ¯
- ğŸ‘¥ **ç”¨æˆ·ç®¡ç†** - ç®¡ç†æ³¨å†Œç”¨æˆ·æ•°æ®
- ğŸ’¬ **ç”¨æˆ·ç•™è¨€** - æŸ¥çœ‹å’Œç®¡ç†ç”¨æˆ·æäº¤çš„ç•™è¨€
- ğŸ“§ **E-Club è®¢é˜…** - ç®¡ç†é‚®ä»¶è®¢é˜…ç”¨æˆ·
- ğŸ“Š **ä»ªè¡¨ç›˜** - æ•°æ®ç»Ÿè®¡å’Œç³»ç»Ÿæ¦‚è§ˆ

## æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: Next.js 14 + React 18
- **UI æ¡†æ¶**: Refine + TailwindCSS
- **æ•°æ®åº“**: Supabase (PostgreSQL)
- **éƒ¨ç½²å¹³å°**: Vercel
- **åŒ…ç®¡ç†å™¨**: pnpm

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pnpm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env.local` æ–‡ä»¶å¹¶æ·»åŠ æ‚¨çš„ Supabase é…ç½®ï¼š

```env
# Supabase åŸºç¡€é…ç½®
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# Supabase æœåŠ¡å¯†é’¥ï¼ˆç”¨äºç»•è¿‡ RLS é™åˆ¶ï¼‰
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key
```

### è·å– Supabase å¯†é’¥

1. ç™»å½• [Supabase Dashboard](https://app.supabase.com)
2. é€‰æ‹©æ‚¨çš„é¡¹ç›®
3. è¿›å…¥ Settings > API
4. å¤åˆ¶ä»¥ä¸‹å¯†é’¥ï¼š
   - `Project URL` â†’ `NEXT_PUBLIC_SUPABASE_URL`
   - `anon public` â†’ `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - `service_role` â†’ `SUPABASE_SERVICE_ROLE_KEY` âš ï¸ **ä¿å¯†ï¼**

âš ï¸ **é‡è¦æé†’**: `service_role` å¯†é’¥æ‹¥æœ‰å®Œå…¨æ•°æ®åº“è®¿é—®æƒé™ï¼Œè¯·å¦¥å–„ä¿ç®¡ï¼Œä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼

### 3. æ•°æ®åº“è®¾ç½®

ç¡®ä¿æ‚¨çš„ Supabase æ•°æ®åº“å·²ç»æ‰§è¡Œäº† `metiokulto-web/database/schema_supabase.sql` ä¸­çš„ SQL è„šæœ¬ï¼Œåˆ›å»ºäº†ä»¥ä¸‹æ•°æ®è¡¨ï¼š

- `tb_product` - äº§å“ä¿¡æ¯è¡¨
- `tb_user` - ç”¨æˆ·è¡¨
- `user_leave` - ç”¨æˆ·ç•™è¨€è¡¨
- `tb_eclub` - E-Club è®¢é˜…è¡¨

#### RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰ç­–ç•¥é…ç½®

ä¸ºäº†è§£å†³ "row-level security policy" é”™è¯¯ï¼Œéœ€è¦åœ¨ Supabase SQL ç¼–è¾‘å™¨ä¸­æ‰§è¡Œ `database/rls-policies.sql` æ–‡ä»¶ä¸­çš„ SQL è¯­å¥ï¼Œæˆ–è€…æ‰‹åŠ¨é…ç½®ä»¥ä¸‹ç­–ç•¥ï¼š

1. è¿›å…¥ Supabase Dashboard > Authentication > Policies
2. ä¸ºæ¯ä¸ªè¡¨æ·»åŠ ç­–ç•¥ï¼š
   - å…è®¸å…¬å¼€è¯»å–ï¼š`FOR SELECT USING (true)`
   - å…è®¸æœåŠ¡è§’è‰²å®Œå…¨è®¿é—®ï¼š`USING (auth.role() = 'service_role')`

#### æ¶æ„è¯´æ˜

æœ¬é¡¹ç›®ä½¿ç”¨æœåŠ¡ç«¯ API è·¯ç”±æ¥å¤„ç†æ•°æ®æ“ä½œï¼Œé€šè¿‡ `service_role` å¯†é’¥ç»•è¿‡ RLS é™åˆ¶ï¼š

- å‰ç«¯ â†’ API è·¯ç”± (`/api/products`) â†’ æœåŠ¡ç«¯ Supabase å®¢æˆ·ç«¯ â†’ æ•°æ®åº“
- è¿™æ ·å¯ä»¥ç¡®ä¿æ•°æ®æ“ä½œçš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

åº”ç”¨å°†åœ¨ http://localhost:3000 ä¸Šè¿è¡Œã€‚

### 5. æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
pnpm build
pnpm start
```

## éƒ¨ç½²åˆ° Vercel

1. å°†ä»£ç æ¨é€åˆ° GitHub ä»“åº“
2. åœ¨ Vercel ä¸­å¯¼å…¥é¡¹ç›®
3. é…ç½®ç¯å¢ƒå˜é‡ï¼š
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
4. éƒ¨ç½²

## é¡¹ç›®ç»“æ„

```
metiokulto-back/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router é¡µé¢
â”‚   â”‚   â”œâ”€â”€ page.tsx           # ä»ªè¡¨ç›˜é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ products/          # äº§å“ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ users/             # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ messages/          # ç”¨æˆ·ç•™è¨€
â”‚   â”‚   â””â”€â”€ eclub/             # E-Clubè®¢é˜…
â”‚   â”œâ”€â”€ components/            # å…±äº«ç»„ä»¶
â”‚   â”‚   â””â”€â”€ Navigation.tsx     # å¯¼èˆªç»„ä»¶
â”‚   â”œâ”€â”€ providers/             # Refine æä¾›ç¨‹åº
â”‚   â”‚   â”œâ”€â”€ auth-provider/     # è®¤è¯æä¾›ç¨‹åº
â”‚   â”‚   â””â”€â”€ data-provider/     # æ•°æ®æä¾›ç¨‹åº
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ supabase/          # Supabase å®¢æˆ·ç«¯é…ç½®
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## æ•°æ®è¡¨ç®¡ç†

### äº§å“ç®¡ç† (tb_product)

- äº§å“åç§°ã€SKUã€ä»·æ ¼
- äº§å“ç±»å‹ã€æè¿°ã€FAQ
- å›¾ç‰‡ã€è§†é¢‘é“¾æ¥
- SEO åç§°

### ç”¨æˆ·ç®¡ç† (tb_user)

- ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç 
- å§“åä¿¡æ¯

### ç”¨æˆ·ç•™è¨€ (user_leave)

- è”ç³»ä¿¡æ¯ï¼ˆå§“åã€é‚®ç®±ã€ç”µè¯ï¼‰
- ç•™è¨€ä¸»é¢˜å’Œå†…å®¹
- æäº¤æ—¶é—´

### E-Club è®¢é˜… (tb_eclub)

- è®¢é˜…é‚®ç®±
- è®¢é˜…æ—¶é—´

## å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„ç®¡ç†é¡µé¢

1. åœ¨ `src/app/` ä¸‹åˆ›å»ºæ–°çš„é¡µé¢ç›®å½•
2. ä½¿ç”¨ Refine çš„ `useList`ã€`useCreate`ã€`useUpdate`ã€`useDelete` hooks
3. åœ¨ `src/app/layout.tsx` ä¸­æ·»åŠ èµ„æºé…ç½®
4. åœ¨ `src/components/Navigation.tsx` ä¸­æ·»åŠ å¯¼èˆªé“¾æ¥

### è‡ªå®šä¹‰æ ·å¼

é¡¹ç›®ä½¿ç”¨ TailwindCSSï¼Œå¯ä»¥ç›´æ¥åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Tailwind ç±»åã€‚

## è´¡çŒ®

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## è®¸å¯è¯

MIT License
